---
title: "STAT 526 HW 7"
author: "Satoshi Ido (ID: 34788706)"
date: 20 April 2023
output: pdf_document
---

```{r setup, include = FALSE, cache = FALSE}
knitr::opts_chunk$set(
    echo = TRUE,
    warning = FALSE,
    message = FALSE)
```

# dataset
```{r}
# Q1
diet <- read.csv("526/diet.csv")
head(diet)
# Q2
ovarian <- read.csv("526/ovarian.csv")
head(ovarian)
```

```{r}
library("survival")
library("survminer")
library("rms")
```

# Q1
```{r}
# fit a Kaplan-Meier and plot it
km <- survfit(Surv(futime, fustat) ~ fat, data = diet[31:90, ])
plot(km, main = "Survival Proportions: ")
ggsurvplot(km, conf.type = "log-log")
plot(coxph(cox.fit))

# Cox model
cox.fit <- coxph(Surv(futime, fustat) ~ fat, data = diet[31:90, ])
cox.fit

# Q1-b
# logrank test
surv_diff <- survdiff(Surv(futime, fustat) ~ fat, data = diet[31:90, ])
surv_diff

# Q1-c
# logrank test
surv_diff2 <- survdiff(Surv(futime, fustat) ~ fat, data = diet)
surv_diff2

```

# Q2
```{r}
# Q2-a
km2 <- survfit(Surv(futime, fustat) ~ rx, data = ovarian)
tmp <- survreg(Surv(futime, fustat) ~ rx, data = ovarian)

ggsurvplot(km2,
        conf.int = TRUE,
        conf.type = "plain",
        title = "Plot of Kaplan-Meier with CI type = 'plain'"
        )

ggsurvplot(km2,
        conf.int = TRUE,
        conf.type = "log",
        title = "Plot of Kaplan-Meier with CI type = 'log'"
        )

ggsurvplot(km2,
        conf.int = TRUE,
        fun = "cloglog",
        title = "Plot of Kaplan-Meier with CI type = 'log-log'"
        )

# Q2-b
wei <- survfit(Surv(futime, fustat) ~ rx, data = ovarian)
plot(wei,
    fun = "cloglog",
    main = "a log-log plot of t-lambda(t) in the two trt groupss")

# Q2-c
wei2 <- survreg(
        formula = Surv(futime, fustat) ~ age + ecog.ps + strata(rx),
        data = ovarian,
        dist = "weibull"
        )
summary(wei2)

wei3 <- survreg(
        formula = Surv(futime, fustat) ~ age + rx,
        data = ovarian,
        scale = 1
        )
summary(wei3)
```